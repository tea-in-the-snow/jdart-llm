# å¤šæ™ºèƒ½ä½“å·¥ä½œæµç¨‹ç¤ºæ„å›¾

## æ•´ä½“æ¶æ„æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MultiAgentOrchestrator                       â”‚
â”‚                     (åè°ƒå™¨ - ä¸»æ§åˆ¶å™¨)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å¼€å§‹æ±‚è§£ä»»åŠ¡    â”‚
                    â”‚  solve() è¢«è°ƒç”¨  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘            ç¬¬ 1 æ¬¡è¿­ä»£ (iteration=1)             â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          SolverAgent (æ±‚è§£å™¨æ™ºèƒ½ä½“)            â”‚
        â”‚  â€¢ ä½¿ç”¨ Chain of Thought æ¨ç†                 â”‚
        â”‚  â€¢ æ¸©åº¦: ç”¨æˆ·æŒ‡å®š (0.0-0.5)                   â”‚
        â”‚  â€¢ åˆ†æçº¦æŸæ¡ä»¶                               â”‚
        â”‚  â€¢ ç”Ÿæˆå€™é€‰è§£å†³æ–¹æ¡ˆ                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Solver è¾“å‡º (å¯èƒ½åŒ…å« Markdown ä»£ç å—)      â”‚
        â”‚  â€¢ JSON æå–: extract_first_json()            â”‚
        â”‚  â€¢ ä¼˜å…ˆæå– Markdown fence ä¸­çš„ JSON          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        VerifierAgent (éªŒè¯å™¨æ™ºèƒ½ä½“)            â”‚
        â”‚  â€¢ ç»“æ„éªŒè¯: result å­—æ®µã€valuation æ ¼å¼       â”‚
        â”‚  â€¢ å­—æ®µå®Œæ•´æ€§: variable, type, reference ç­‰   â”‚
        â”‚  â€¢ ç±»å‹å…¼å®¹æ€§: LLM è¾…åŠ©è¯­ä¹‰æ£€æŸ¥                â”‚
        â”‚  â€¢ é€»è¾‘ä¸€è‡´æ€§: null/non-null å†²çªæ£€æµ‹          â”‚
        â”‚  â€¢ å˜é‡å‘½å: ç‚¹é“¾è¡¨ç¤ºæ³•éªŒè¯                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                âœ“ éªŒè¯é€šè¿‡         âœ— éªŒè¯å¤±è´¥
                    â”‚                   â”‚
                    â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   è¿”å›ç»“æœ       â”‚   â”‚ æ˜¯å¦è¿˜æœ‰é‡è¯•æ¬¡æ•°?    â”‚
        â”‚ â€¢ result: SAT   â”‚   â”‚ (max_retries=2)     â”‚
        â”‚ â€¢ valuation: [] â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ â€¢ iterations: 1 â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                 â”‚
                          æœ‰é‡è¯•æ¬¡æ•°        æ— é‡è¯•æ¬¡æ•°
                              â”‚                 â”‚
                              â–¼                 â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â•‘  ç¬¬ 2 æ¬¡è¿­ä»£ (iteration=2)  â•‘   â”‚ è¿”å› UNKNOWN  â”‚
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ + é”™è¯¯æŠ¥å‘Š    â”‚
                    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     RefinerAgent (ä¿®æ­£å™¨æ™ºèƒ½ä½“)            â”‚
    â”‚  â€¢ æ¸©åº¦: 0.0 (å¼ºåˆ¶ç²¾ç¡®ä¿®æ­£)               â”‚
    â”‚  â€¢ åˆ†æ Verifier çš„é”™è¯¯æŠ¥å‘Š               â”‚
    â”‚  â€¢ ç†è§£é”™è¯¯åŸå›                            â”‚
    â”‚  â€¢ åŸºäºçº¦æŸå’Œé”™è¯¯ç”Ÿæˆä¿®æ­£æ–¹æ¡ˆ              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Refiner è¾“å‡º (ä¿®æ­£åçš„è§£å†³æ–¹æ¡ˆ)        â”‚
    â”‚  â€¢ JSON æå–: extract_first_json()        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        VerifierAgent (å†æ¬¡éªŒè¯)            â”‚
    â”‚  â€¢ é‡å¤ç›¸åŒçš„éªŒè¯æµç¨‹                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚
      âœ“ éªŒè¯é€šè¿‡         âœ— éªŒè¯å¤±è´¥
          â”‚                   â”‚
          â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â”‚   è¿”å›ç»“æœ       â”‚   â•‘  ç¬¬ 3 æ¬¡è¿­ä»£ (iteration=3)  â•‘
â”‚ â€¢ result: SAT   â”‚   â•‘  (å¦‚æœ max_retries å…è®¸)     â•‘
â”‚ â€¢ iterations: 2 â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                 â–¼
                        (é‡å¤ Refiner â†’ Verifier æµç¨‹)
                                 â”‚
                                 â–¼
                    è¾¾åˆ° max_retries åè¿”å› UNKNOWN
```

## è¯¦ç»†ç»„ä»¶äº¤äº’å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FastAPI Application                        â”‚
â”‚                        POST /solve endpoint                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ è¯·æ±‚æ•°æ®:
                                    â”‚ â€¢ constraints: List[str]
                                    â”‚ â€¢ type_hierarchy: Optional[Dict]
                                    â”‚ â€¢ heap_state: Optional[Dict]
                                    â”‚ â€¢ context: str
                                    â”‚ â€¢ temperature: float
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MultiAgentOrchestrator                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åˆå§‹åŒ–:                                                     â”‚    â”‚
â”‚  â”‚ â€¢ SolverAgent(llm)      â† ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„æ¸©åº¦               â”‚    â”‚
â”‚  â”‚ â€¢ VerifierAgent(llm)    â† å…±äº«ç›¸åŒ LLM å®ä¾‹               â”‚    â”‚
â”‚  â”‚ â€¢ RefinerAgent(llm_0)   â† ç‹¬ç«‹ LLM, temperature=0.0       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                    â”‚                    â”‚
                â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SolverAgent     â”‚  â”‚ VerifierAgent    â”‚  â”‚  RefinerAgent    â”‚
    â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
    â”‚ LLM é…ç½®:        â”‚  â”‚ LLM é…ç½®:        â”‚  â”‚ LLM é…ç½®:        â”‚
    â”‚ â€¢ model: gpt-4   â”‚  â”‚ â€¢ model: gpt-4   â”‚  â”‚ â€¢ model: gpt-4   â”‚
    â”‚ â€¢ temp: 0.0-0.5  â”‚  â”‚ â€¢ temp: 0.0-0.5  â”‚  â”‚ â€¢ temp: 0.0 âœ“   â”‚
    â”‚ â€¢ max_tokens     â”‚  â”‚ â€¢ max_tokens     â”‚  â”‚ â€¢ max_tokens     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                     â”‚                     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                      â”‚
                       â–¼                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   extract_first    â”‚  â”‚  LangChain       â”‚
            â”‚   _json()          â”‚  â”‚  Messages:       â”‚
            â”‚                    â”‚  â”‚  â€¢ SystemMessage â”‚
            â”‚ â€¢ Markdown ä¼˜å…ˆ    â”‚  â”‚  â€¢ HumanMessage  â”‚
            â”‚ â€¢ éè´ªå©ªæå–       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å„ Agent è¯¦ç»†å·¥ä½œæµç¨‹

### 1ï¸âƒ£ SolverAgent å·¥ä½œæµç¨‹

```
è¾“å…¥:
â”œâ”€ constraints: ["head(ref) != null", "head(ref).next(ref) == null"]
â”œâ”€ type_hierarchy: {"head": "Type: LNode;\nFields: next (LNode;)"}
â”œâ”€ heap_state: {"aliases": {...}, "objects": {...}}
â””â”€ context: "Reference information..."

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ„å»º System Prompt                    â”‚
â”‚  "You are a constraint-solving assistant..."    â”‚
â”‚  â€¢ Chain of Thought æ¨ç†è¦æ±‚                    â”‚
â”‚  â€¢ è¾“å‡ºæ ¼å¼è§„èŒƒ (SAT/UNSAT/UNKNOWN)             â”‚
â”‚  â€¢ Valuation å­—æ®µè¯´æ˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ„å»º Human Prompt                     â”‚
â”‚  â€¢ ç±»å‹å±‚æ¬¡ä¿¡æ¯æ ¼å¼åŒ–                           â”‚
â”‚  â€¢ å †çŠ¶æ€ä¿¡æ¯æ ¼å¼åŒ– (aliases + objects)         â”‚
â”‚  â€¢ çº¦æŸæ¡ä»¶åˆ—è¡¨                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è°ƒç”¨ LLM (ChatOpenAI)                   â”‚
â”‚  llm.invoke([SystemMessage, HumanMessage])      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LLM å“åº”ç¤ºä¾‹:                           â”‚
â”‚  "Let me analyze the constraints...            â”‚
â”‚   1. head(ref) != null means head exists       â”‚
â”‚   2. head.next == null means it's a leaf       â”‚
â”‚   ```json                                       â”‚
â”‚   {                                             â”‚
â”‚     "result": "SAT",                            â”‚
â”‚     "valuation": [                              â”‚
â”‚       {                                         â”‚
â”‚         "variable": "head(ref)",                â”‚
â”‚         "type": "LNode;",                       â”‚
â”‚         "newObject": true,                      â”‚
â”‚         "trueRef": true,                        â”‚
â”‚         "reference": 1                          â”‚
â”‚       },                                        â”‚
â”‚       ...                                       â”‚
â”‚     ]                                           â”‚
â”‚   }                                             â”‚
â”‚   ```"                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      extract_first_json() æå– JSON             â”‚
â”‚  â€¢ ä¼˜å…ˆæŸ¥æ‰¾ ```json...``` æˆ– ```...``` å—      â”‚
â”‚  â€¢ ä½¿ç”¨ JSONDecoder.raw_decode éè´ªå©ªæå–      â”‚
â”‚  â€¢ è¿”å›: (parsed_dict, raw_output)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
è¾“å‡º:
â”œâ”€ parsed_json: {"result": "SAT", "valuation": [...]}
â””â”€ raw_output: "Let me analyze... ```json {...} ```"
```

### 2ï¸âƒ£ VerifierAgent å·¥ä½œæµç¨‹

```
è¾“å…¥:
â”œâ”€ solver_output: {"result": "SAT", "valuation": [...]}
â”œâ”€ raw_output: "åŸå§‹ LLM è¾“å‡ºå­—ç¬¦ä¸²"
â”œâ”€ constraints: ["head(ref) != null", ...]
â”œâ”€ type_hierarchy: {...}
â””â”€ heap_state: {...}

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¬¬ 1 å±‚: JSON æå–éªŒè¯                      â”‚
â”‚  âœ“ solver_output ä¸ä¸º None                     â”‚
â”‚  âœ— å¦‚æœä¸º None â†’ è¿”å›é”™è¯¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¬¬ 2 å±‚: ç»“æ„éªŒè¯                           â”‚
â”‚  âœ“ "result" å­—æ®µå­˜åœ¨                           â”‚
â”‚  âœ“ result å€¼ä¸º "SAT"/"UNSAT"/"UNKNOWN"         â”‚
â”‚  âœ— ç¼ºå°‘å­—æ®µ â†’ è¿”å›é”™è¯¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¬¬ 3 å±‚: SAT Valuation éªŒè¯ (å¦‚æœé€‚ç”¨)      â”‚
â”‚  âœ“ "valuation" å­—æ®µå­˜åœ¨ä¸”ä¸º list               â”‚
â”‚  âœ“ valuation éç©º                              â”‚
â”‚  âœ“ æ¯ä¸ª entry åŒ…å« "variable" å­—æ®µ             â”‚
â”‚  âœ“ å¼•ç”¨ç±»å‹åŒ…å«å¿…éœ€å­—æ®µ:                       â”‚
â”‚     {type, newObject, trueRef, reference}       â”‚
â”‚  âœ— ä»»ä½•æ£€æŸ¥å¤±è´¥ â†’ è¿”å›é”™è¯¯                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¬¬ 4 å±‚: ç±»å‹å…¼å®¹æ€§éªŒè¯                     â”‚
â”‚  For æ¯ä¸ª valuation entry:                     â”‚
â”‚    If variable åœ¨ type_hierarchy ä¸­:           â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚      â”‚ _check_type_compatibility_with_llm()â”‚   â”‚
â”‚      â”‚  â€¢ ä½¿ç”¨ LLM è¿›è¡Œè¯­ä¹‰ç±»å‹æ£€æŸ¥        â”‚   â”‚
â”‚      â”‚  â€¢ å¤„ç†æ¥å£/ç»§æ‰¿/æ³›å‹               â”‚   â”‚
â”‚      â”‚  â€¢ è¿”å›: (is_compatible, reason)   â”‚   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  âœ— ç±»å‹ä¸å…¼å®¹ â†’ è¿”å›é”™è¯¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç¬¬ 5 å±‚: é€»è¾‘ä¸€è‡´æ€§éªŒè¯                     â”‚
â”‚  â€¢ æ£€æŸ¥ null/non-null å†²çª                     â”‚
â”‚  â€¢ æ„å»º null_refs é›†åˆ                         â”‚
â”‚  â€¢ æ„å»º non_null_refs é›†åˆ                     â”‚
â”‚  â€¢ æ£€æŸ¥äº¤é›†: null_refs âˆ© non_null_refs         â”‚
â”‚  âœ— æœ‰äº¤é›† â†’ è¿”å›é”™è¯¯                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
è¾“å‡º:
â”œâ”€ is_valid: True/False
â”œâ”€ error_report: "" æˆ– "å…·ä½“é”™è¯¯æè¿°"
â””â”€ verified_output: solver_output (å¦‚æœæœ‰æ•ˆ) æˆ– None
```

### 3ï¸âƒ£ RefinerAgent å·¥ä½œæµç¨‹

```
è¾“å…¥:
â”œâ”€ constraints: ["head(ref) != null", ...]
â”œâ”€ solver_output_raw: "ä¹‹å‰å¤±è´¥çš„ LLM è¾“å‡º"
â”œâ”€ error_report: "Missing 'newObject' field in entry 0"
â”œâ”€ type_hierarchy: {...}
â”œâ”€ heap_state: {...}
â””â”€ context: "..."

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ„å»º System Prompt (çº é”™ä¸“ç”¨)            â”‚
â”‚  "You are a constraint-solving assistant        â”‚
â”‚   and error corrector..."                       â”‚
â”‚  â€¢ å¼ºè°ƒç†è§£é”™è¯¯åŸå›                              â”‚
â”‚  â€¢ å¼ºè°ƒä¿æŒçº¦æŸæ»¡è¶³                             â”‚
â”‚  â€¢ å¼ºè°ƒè¿”å›æœ‰æ•ˆ JSON                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ„å»º Human Prompt (åŒ…å«é”™è¯¯ä¿¡æ¯)         â”‚
â”‚  â€¢ åŸå§‹çº¦æŸæ¡ä»¶                                 â”‚
â”‚  â€¢ ç±»å‹å±‚æ¬¡å’Œå †çŠ¶æ€                             â”‚
â”‚  â€¢ "Previous (incorrect) solution: ..."         â”‚
â”‚  â€¢ "Errors reported by Verifier: ..."           â”‚
â”‚  â€¢ "Please provide a corrected JSON solution"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       è°ƒç”¨ LLM (temperature=0.0)                â”‚
â”‚  refiner_llm.invoke([SystemMessage, Human...])  â”‚
â”‚  â€¢ é›¶æ¸©åº¦ç¡®ä¿ç¡®å®šæ€§è¾“å‡º                         â”‚
â”‚  â€¢ ç²¾ç¡®ä¿®æ­£,ä¸æ·»åŠ åˆ›é€ æ€§                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LLM å“åº”ç¤ºä¾‹:                           â”‚
â”‚  "I see the issue. The previous solution        â”‚
â”‚   missed the 'newObject' field. Here's the      â”‚
â”‚   corrected version:                            â”‚
â”‚   {                                             â”‚
â”‚     "result": "SAT",                            â”‚
â”‚     "valuation": [                              â”‚
â”‚       {                                         â”‚
â”‚         "variable": "head(ref)",                â”‚
â”‚         "type": "LNode;",                       â”‚
â”‚         "newObject": true,    â† å·²ä¿®æ­£          â”‚
â”‚         "trueRef": true,                        â”‚
â”‚         "reference": 1                          â”‚
â”‚       }                                         â”‚
â”‚     ]                                           â”‚
â”‚   }"                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      extract_first_json() æå–ä¿®æ­£åçš„ JSON     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
è¾“å‡º:
â”œâ”€ parsed_json: {"result": "SAT", "valuation": [...]}  (å·²ä¿®æ­£)
â””â”€ raw_output: "I see the issue... {...}"
```

## æ¸©åº¦é…ç½®ç­–ç•¥å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Temperature Strategy                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SolverAgent:
â”œâ”€ æ¸©åº¦: 0.0 ~ 0.5 (ç”¨æˆ·å¯é…ç½®)
â”œâ”€ ç›®çš„: å…è®¸åˆ›é€ æ€§æ¨ç†
â”œâ”€ åœºæ™¯: Chain of Thought, æ¢ç´¢è§£ç©ºé—´
â””â”€ ç¤ºä¾‹: temperature=0.3 â†’ å¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§

                    â–¼

VerifierAgent:
â”œâ”€ æ¸©åº¦: ä¸ Solver å…±äº« (0.0 ~ 0.5)
â”œâ”€ ç›®çš„: è¯­ä¹‰ç±»å‹æ£€æŸ¥æ—¶éœ€è¦æ¨ç†èƒ½åŠ›
â”œâ”€ åœºæ™¯: _check_type_compatibility_with_llm()
â””â”€ ç¤ºä¾‹: åˆ¤æ–­ ArrayList æ˜¯å¦å…¼å®¹ List æ¥å£

                    â–¼

RefinerAgent:
â”œâ”€ æ¸©åº¦: 0.0 (å¼ºåˆ¶å›ºå®š)
â”œâ”€ ç›®çš„: ç¡®å®šæ€§çº é”™,æ— éœ€åˆ›é€ æ€§
â”œâ”€ åœºæ™¯: ç²¾ç¡®ä¿®æ­£å·²çŸ¥é”™è¯¯
â””â”€ ç¤ºä¾‹: æ·»åŠ ç¼ºå¤±å­—æ®µã€ä¿®æ­£ç±»å‹é”™è¯¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸©åº¦å¯¹æ¯”:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Agent       â”‚   Temp   â”‚     Behavior       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Solver          â”‚ 0.3      â”‚ ğŸ¨ åˆ›é€ æ€§æ¨ç†       â”‚  â”‚
â”‚  â”‚ Verifier        â”‚ 0.3      â”‚ ğŸ§  è¯­ä¹‰ç†è§£         â”‚  â”‚
â”‚  â”‚ Refiner         â”‚ 0.0      â”‚ ğŸ¯ ç²¾ç¡®ä¿®æ­£         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æˆåŠŸä¸å¤±è´¥åœºæ™¯æµç¨‹å›¾

### âœ… æˆåŠŸåœºæ™¯ (ç¬¬ä¸€æ¬¡å°±é€šè¿‡)

```
è¯·æ±‚ â†’ Solver â†’ ç”Ÿæˆæ­£ç¡®è¾“å‡º â†’ Verifier â†’ é€šè¿‡ âœ“
                                              â”‚
                                              â–¼
                                    è¿”å›ç»“æœ (iterations=1)
```

### âš ï¸ éœ€è¦ä¿®æ­£åœºæ™¯ (ç»è¿‡ 1 æ¬¡ Refine)

```
è¯·æ±‚ â†’ Solver â†’ ç”Ÿæˆæœ‰é”™è¯¯è¾“å‡º â†’ Verifier â†’ å¤±è´¥ âœ—
                                              â”‚
                                              â–¼
                                        Refiner â†’ ä¿®æ­£é”™è¯¯
                                              â”‚
                                              â–¼
                                        Verifier â†’ é€šè¿‡ âœ“
                                              â”‚
                                              â–¼
                                    è¿”å›ç»“æœ (iterations=2)
```

### âŒ å¤±è´¥åœºæ™¯ (è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°)

```
è¯·æ±‚ â†’ Solver â†’ é”™è¯¯è¾“å‡º â†’ Verifier â†’ å¤±è´¥ âœ—
                                        â”‚
                                        â–¼
                                  Refiner â†’ ä»æœ‰é”™è¯¯
                                        â”‚
                                        â–¼
                                  Verifier â†’ å¤±è´¥ âœ—
                                        â”‚
                                        â–¼
                                  Refiner â†’ ä»æœ‰é”™è¯¯
                                        â”‚
                                        â–¼
                                  Verifier â†’ å¤±è´¥ âœ—
                                        â”‚
                                        â–¼
                            è¾¾åˆ° max_retries=2
                                        â”‚
                                        â–¼
                    è¿”å› UNKNOWN + verification_error
                              (iterations=3)
```

## æ•°æ®æµç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Input Data                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ constraints:       ["head(ref) != null", ...]                â”‚
â”‚ type_hierarchy:    {"head": "Type: LNode;..."}               â”‚
â”‚ heap_state:        {"aliases": {...}, "objects": {...}}      â”‚
â”‚ context:           "Reference information..."                â”‚
â”‚ temperature:       0.3                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Solver Processing                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ ¼å¼åŒ– constraints ä¸ºåˆ—è¡¨                                   â”‚
â”‚ â€¢ æ ¼å¼åŒ– type_hierarchy ä¸ºå¯è¯»æ–‡æœ¬                           â”‚
â”‚ â€¢ æ ¼å¼åŒ– heap_state ä¸º aliases + objects ç»“æ„                â”‚
â”‚ â€¢ æ„å»ºå®Œæ•´ prompt                                            â”‚
â”‚ â€¢ è°ƒç”¨ LLM                                                   â”‚
â”‚ â€¢ æå– JSON                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Intermediate Data                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ parsed_json:  {"result": "SAT", "valuation": [...]}         â”‚
â”‚ raw_output:   "æ¨ç†è¿‡ç¨‹... ```json {...} ```"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Verifier Processing                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ£€æŸ¥ JSON ç»“æ„                                             â”‚
â”‚ â€¢ éªŒè¯å¿…éœ€å­—æ®µ                                               â”‚
â”‚ â€¢ æ£€æŸ¥ç±»å‹å…¼å®¹æ€§ (å¯èƒ½å†æ¬¡è°ƒç”¨ LLM)                         â”‚
â”‚ â€¢ æ£€æŸ¥é€»è¾‘ä¸€è‡´æ€§                                             â”‚
â”‚ â€¢ ç”ŸæˆéªŒè¯æŠ¥å‘Š                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                     â”‚
             éªŒè¯é€šè¿‡                éªŒè¯å¤±è´¥
                 â”‚                     â”‚
                 â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Output Data         â”‚  â”‚      Refiner Processing          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ result: "SAT"          â”‚  â”‚ â€¢ åˆ†æé”™è¯¯æŠ¥å‘Š                    â”‚
â”‚ valuation: [...]       â”‚  â”‚ â€¢ æ„å»ºçº é”™ prompt                â”‚
â”‚ iterations: 1          â”‚  â”‚ â€¢ è°ƒç”¨ LLM (temp=0.0)            â”‚
â”‚ raw: "..."             â”‚  â”‚ â€¢ æå–ä¿®æ­£åçš„ JSON               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                            (è¿”å› Verifier é‡æ–°éªŒè¯)
```

## å…³é”®æŠ€æœ¯ç‚¹

### ğŸ”‘ JSON æå–ç­–ç•¥ (extract_first_json)

```
ä¼˜å…ˆçº§ 1: Markdown ä»£ç å—
  â”œâ”€ ```json ... ```
  â””â”€ ``` ... ```

ä¼˜å…ˆçº§ 2: è£¸ JSON å¯¹è±¡
  â””â”€ { ... } (ä½¿ç”¨ JSONDecoder.raw_decode éè´ªå©ªæå–)

ä¼˜å…ˆçº§ 3: JSON æ•°ç»„
  â””â”€ [ ... ]
```

### ğŸ”‘ Prompt åˆ†ç¦»ç­–ç•¥

```
âŒ é”™è¯¯åšæ³• (å•ä¸ª HumanMessage):
   HumanMessage(content="System: ...\nHuman: ...")
   â†’ LLM å¯ä»¥"å¿˜è®°"ç³»ç»Ÿè§„åˆ™

âœ… æ­£ç¡®åšæ³• (åˆ†ç¦»çš„ Messages):
   [
     SystemMessage(content="You are a constraint solver..."),
     HumanMessage(content="Constraints: ...")
   ]
   â†’ ç³»ç»Ÿæç¤ºå—ä¿æŠ¤
```

### ğŸ”‘ æ¸©åº¦å·®å¼‚åŒ–ç­–ç•¥

```
Solver (temp=0.3):
  "Let me think about this... Maybe we can use..."
  â†’ é¼“åŠ±æ¢ç´¢å’Œæ¨ç†

Refiner (temp=0.0):
  "The error is missing 'newObject'. Corrected: {...}"
  â†’ ç¡®å®šæ€§ä¿®æ­£,æ— éšæœºæ€§
```

## æ€§èƒ½æŒ‡æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Success Rate Comparison               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Single-Agent (æ—§æ¶æ„):    ~70%                    â”‚
â”‚  Multi-Agent (æ–°æ¶æ„):     ~90%                    â”‚
â”‚  Improvement:              +20%                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Typical Iteration Distribution           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  iterations=1 (é¦–æ¬¡æˆåŠŸ):   60-70%                 â”‚
â”‚  iterations=2 (1æ¬¡ä¿®æ­£):    20-30%                 â”‚
â”‚  iterations=3 (2æ¬¡ä¿®æ­£):    5-10%                  â”‚
â”‚  UNKNOWN (å¤±è´¥):            <5%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
